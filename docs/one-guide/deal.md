# 处理器

## 硬件组成

系统硬件结构大致是这样的：
![硬件组成](http://ww1.sinaimg.cn/large/e1b0b6d4ly1g2hjlhms50j20ns0gyn7p.jpg)

### 总线

**总线**贯穿整个系统，是一组电子管道。它携带信息字节服务，并负责在各个部件间传递。通常总线被设计成传送定长的字节块，也就是**字**。字中的字节数是一个基本的系统参数，就是我们所说的**位**。现代计算机一般是 32 位（4个字节）或者 64 位（8个字节）。

### I/O 设备

I/O 设备是系统与外部世界联系的通道。一般有，键盘、键盘、显示器和磁盘等。每个输入输出设备都过个一个控制器或者适配器与 I/O 总线相连。

### 主存储器

主存是一个临时存储设备，在处理执行程序时，用来存放程序和程序处理的数据。从物理上讲，主存是由一组动态随机存取存储器芯片组成的。从逻辑上来讲，存储器是一个线性的字节数组，每个字节都有其唯一的**地址**（数组索引）。

### 处理器（CPU）

CPU 是解释存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备（**寄存器**），称为程序计数器（PC）。在任何时刻，PC都指向主存中的某条机器语言指令（**即含有该条指令的地址**）。**算术逻辑单元**(arithmetic and logic unit) 是能实现多组算术运算和逻辑运算的组合逻辑电路，简称ALU。  

CPU 可能会执行以下的操作：

- **加载：** 从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。

- **存储：** 从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置（数组索引）上原来的内容。

- **操作：** 把两个寄存器的内容复制到 ALU，ALU 对这个两个字做算术运算，并将结果存放到一个存储器上。

- **跳转：** 从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖 PC 中原来的值。

## 运行 hello 程序

执行 hello 程序是在 shell 中执行：

```sh
./hello
# 输出
hello world
```

此过程可分为三个阶段

1. **shell 命令行键入`./hello`。** shell 程序将字符逐一读入存储器，再把它放到主存中，如下图：
![shell](http://ww1.sinaimg.cn/large/e1b0b6d4ly1g2hju4l3f3j20lh0fu7gi.jpg)
2. **按下 Enter 键，shell 程序加载 hello 文件。** 这些指令将 hello 文件中的代码和数据从磁盘复制到主存，步骤如下：
![加载](https://ws1.sinaimg.cn/large/e1b0b6d4ly1g2hk6cgio2j20oo0gcws4.jpg)
3. **处理器执行 hello。** 在 CPU 中执行代码，结果从主存复制到寄存器文件，再从寄存器复制到显示设备，最终显示在屏幕上：
![输出](https://ws1.sinaimg.cn/large/e1b0b6d4ly1g2i5q3ahtpj20nq0g5dtk.jpg)

## 高速缓存

上面的示例，我们会发现，系统花费了大量的时间把信息从一个地方挪到另一个地方。因此，系统设计者的一个主要目标就是是这些操作尽可能快的完成。  

**高速缓存存储器**可以存放处理器近期可能会需要的信息，由于紧邻寄存器，其 I/O 效率非常高：
![高速缓存](https://ws1.sinaimg.cn/large/e1b0b6d4ly1g2i5ykmtxqj20md09vn46.jpg)
程序员利用高速缓存器可以将性能提高一个数量级！

## 存储层次结构

在处理器和一个较大较慢的设备之间插入一个更小更快的存储设备的想法已经成为一个普遍的概念。这样的想法使得计算机系统中存储设备形成了一个金字塔形式的**存储器层次结构**。如下图：
![存储器层次结构](https://ws1.sinaimg.cn/large/e1b0b6d4ly1g2i63ksjexj20re0gm16i.jpg)
主要特征就是**上一层的存储器作为低一层的存储器的高速缓存**。